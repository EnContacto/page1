<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Informe de An√°lisis de Disco</title>

<!-- Fuente y estilos -->
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: var(--bg);
        color: var(--text);
        transition: background 0.3s, color 0.3s;
    }

    :root {
        --bg: #ffffff;
        --text: #000000;
        --card-bg: #f9f9f9;
        --border: #ddd;
    }

    .dark {
        --bg: #121212;
        --text: #e0e0e0;
        --card-bg: #1e1e1e;
        --border: #333;
    }

    .container {
        max-width: 1200px;
        margin: auto;
    }

    h1 {
        text-align: center;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: var(--card-bg);
    }

    th, td {
        border: 1px solid var(--border);
        padding: 10px;
        text-align: left;
    }

    th {
        cursor: pointer;
        background: #007bff33;
    }

    input[type="text"] {
        padding: 10px;
        width: 300px;
        margin-top: 10px;
        border: 1px solid var(--border);
        background: var(--card-bg);
        color: var(--text);
    }

    button {
        padding: 10px 15px;
        background: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
        margin: 10px 0;
    }

    button:hover {
        opacity: 0.9;
    }

    /* Responsive */
    @media (max-width: 768px) {
        table, thead, tbody, tr, th, td {
            display: block;
        }

        th {
            position: sticky;
            top: 0;
        }
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

<div class="container">

<h1>üìä Informe de An√°lisis de Disco</h1>

<button onclick="toggleTheme()">Cambiar tema üåô/‚òÄÔ∏è</button>

<h2>Cargar datos del informe</h2>
<button onclick="cargarDatos()">Cargar informaci√≥n desde data.json</button>

<h3>Buscar</h3>
<input type="text" id="buscador" placeholder="Buscar en la tabla..." onkeyup="filtrarTabla()">

<table id="tablaDatos">
    <thead>
        <tr>
            <th onclick="ordenarTabla(0)">Carpeta</th>
            <th onclick="ordenarTabla(1)">Tama√±o (GB)</th>
            <th onclick="ordenarTabla(2)">Archivos</th>
            <th onclick="ordenarTabla(3)">Subcarpetas</th>
            <th onclick="ordenarTabla(4)">√öltima modificaci√≥n</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<h2>Gr√°ficos</h2>
<canvas id="chart"></canvas>

</div>

<script>
// =========================
// MODO CLARO / OSCURO
// =========================
document.addEventListener("DOMContentLoaded", () => {
    if (localStorage.getItem("tema") === "dark") {
        document.body.classList.add("dark");
    }
});

function toggleTheme() {
    document.body.classList.toggle("dark");
    localStorage.setItem("tema",
        document.body.classList.contains("dark") ? "dark" : "light"
    );
}

// =========================
// CARGAR DATOS DESDE JSON
// =========================
async function cargarDatos() {
    try {
        const response = await fetch("data.json");
        const data = await response.json();

        const tbody = document.querySelector("#tablaDatos tbody");
        tbody.innerHTML = "";

        data.carpetas.forEach(item => {
            let fila = `
                <tr>
                    <td>${item.nombre}</td>
                    <td>${item.tamanoGB}</td>
                    <td>${item.archivos}</td>
                    <td>${item.subcarpetas}</td>
                    <td>${item.ultimaModificacion}</td>
                </tr>
            `;
            tbody.innerHTML += fila;
        });

        generarGrafico(data);
    } catch (error) {
        alert("No se pudo cargar el archivo JSON");
    }
}

// =========================
// FILTRO DE B√öSQUEDA
// =========================
function filtrarTabla() {
    const input = document.getElementById("buscador").value.toLowerCase();
    const rows = document.querySelectorAll("#tablaDatos tbody tr");

    rows.forEach(row => {
        const match = [...row.children].some(td =>
            td.textContent.toLowerCase().includes(input)
        );
        row.style.display = match ? "" : "none";
    });
}

// =========================
// ORDENAMIENTO DE TABLAS
// =========================
let sortAsc = true;

function ordenarTabla(colIndex) {
    const tbody = document.querySelector("#tablaDatos tbody");
    const rows = Array.from(tbody.querySelectorAll("tr"));

    rows.sort((a, b) => {
        const valA = a.children[colIndex].textContent.trim();
        const valB = b.children[colIndex].textContent.trim();

        return sortAsc
            ? valA.localeCompare(valB, undefined, { numeric: true })
            : valB.localeCompare(valA, undefined, { numeric: true });
    });

    sortAsc = !sortAsc;

    tbody.innerHTML = "";
    rows.forEach(row => tbody.appendChild(row));
}

// =========================
// GR√ÅFICOS MEJORADOS
// =========================
let chart;

function generarGrafico(data) {
    const nombres = data.carpetas.map(x => x.nombre);
    const tamanos = data.carpetas.map(x => x.tamanoGB);

    const ctx = document.getElementById("chart");

    if (chart) chart.destroy();

    chart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: nombres,
            datasets: [{
                label: "Tama√±o (GB)",
                data: tamanos
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: info => ` ${info.raw} GB`
                    }
                }
            }
        }
    });
}
</script>

</body>
</html>
